<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Solicitação de Refeições</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  padding:20px;
}

.container{
  max-width:800px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

input, select, textarea{
  width:100%;
  padding:8px;
  margin-bottom:10px;
  border-radius:6px;
  border:1px solid #ccc;
}

button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
}

button:hover{
  opacity:0.9;
}

#modal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
}

.modal-content{
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:400px;
}

#listaRefeicoes{
  margin-top:15px;
}
</style>
</head>

<body>

<div class="container">

<h2>Refeição Principal</h2>

<input id="competencia" placeholder="Competência (ex: 05/2026)">
<input id="empresaTerceirizada" placeholder="Empresa Terceirizada">
<input id="quantidade" type="number" placeholder="Quantidade">
<input id="datas" placeholder="Datas (ex: 10,11,12/05)">
<select id="periodo">
  <option value="Almoço">Almoço</option>
  <option value="Jantar">Jantar</option>
</select>

<button onclick="salvarPrincipal()">Salvar Principal</button>
<button onclick="abrirModal()">Adicionar Extra</button>

<p id="contadorRefeicoes">Refeições extras adicionadas: 0</p>

<div id="listaRefeicoes"></div>

<hr>

<h3>Dados Finais</h3>

<input id="unidade" placeholder="Unidade">
<input id="empresaRefeicao" placeholder="Empresa da Refeição">
<textarea id="nomes" rows="4" placeholder="Nome dos terceirizados"></textarea>

<button onclick="gerarTexto()">Gerar Texto</button>

<textarea id="resultado" rows="10"></textarea>

</div>

<!-- MODAL -->
<div id="modal">
  <div class="modal-content">
    <h3>Adicionar Refeição Extra</h3>

    <input id="m_empresa" placeholder="Empresa Terceirizada">
    <input id="m_quantidade" type="number" placeholder="Quantidade">
    <input id="m_datas" placeholder="Datas">
    <select id="m_periodo">
      <option value="Almoço">Almoço</option>
      <option value="Jantar">Jantar</option>
    </select>

    <button onclick="salvarModal()">Salvar</button>
    <button onclick="fecharModal()">Fechar</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

let lista = [];
let principalAdicionada = false;
let competenciaPrincipalGlobal = "";

window.abrirModal = function(){
  if(!principalAdicionada){
    alert("Adicione primeiro a refeição principal.");
    return;
  }
  document.getElementById("modal").style.display = "flex";
}

window.fecharModal = function(){
  document.getElementById("modal").style.display = "none";
}

window.salvarPrincipal = function(){
  if(principalAdicionada){
    alert("A refeição principal já foi adicionada.");
    return;
  }

  let competencia = document.getElementById("competencia").value;
  let empresa = document.getElementById("empresaTerceirizada").value;
  let quantidade = document.getElementById("quantidade").value;
  let datas = document.getElementById("datas").value;
  let periodo = document.getElementById("periodo").value;

  if (!empresa || !quantidade || !datas) {
    alert("Preencha todos os campos da refeição principal!");
    return;
  }

  competenciaPrincipalGlobal = competencia;

  lista.push({ competencia, empresaTerceirizada: empresa, quantidade, datas, periodo });

  principalAdicionada = true;

  atualizarLista();
  atualizarContador();
}

window.salvarModal = function(){
  let empresa = document.getElementById("m_empresa").value;
  let quantidade = document.getElementById("m_quantidade").value;
  let datas = document.getElementById("m_datas").value;
  let periodo = document.getElementById("m_periodo").value;

  if(!empresa || !quantidade || !datas){
    alert("Preencha todos os campos!");
    return;
  }

  lista.push({
    competencia: competenciaPrincipalGlobal,
    empresaTerceirizada: empresa,
    quantidade,
    datas,
    periodo
  });

  atualizarLista();
  atualizarContador();
  fecharModal();
}

function atualizarContador(){
  let extras = lista.length > 0 ? lista.length - 1 : 0;
  document.getElementById("contadorRefeicoes").innerText =
    "Refeições extras adicionadas: " + extras;
}

function atualizarLista() {
  let container = document.getElementById("listaRefeicoes");
  container.innerHTML = "";

  lista.forEach((item, index) => {
    container.innerHTML += `
    <div style="background:#f1f1f1;padding:10px;margin-bottom:8px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
      <div style="flex:1;min-width:0;word-break:break-word;">
        ${item.competencia} - ${item.datas} - ${item.quantidade} - ${item.periodo} (${item.empresaTerceirizada})
      </div>
      <button onclick="remover(${index})" style="background:#dc2626;">Excluir</button>
    </div>
    `;
  });
}

window.remover = function(index){
  if(index === 0){
    principalAdicionada = false;
    competenciaPrincipalGlobal = "";
  }

  lista.splice(index, 1);
  atualizarLista();
  atualizarContador();
}

window.gerarTexto = function(){
  let unidade = document.getElementById("unidade").value;
  let empresaRefeicao = document.getElementById("empresaRefeicao").value;
  let nomes = document.getElementById("nomes").value;

  let textoFinal = "Prezados(as),\n\n";
  textoFinal += "Segue lista de refeições.\n";
  textoFinal += "Empresa: " + empresaRefeicao + "\n\n";

  lista.forEach(function(item){
    textoFinal += item.competencia + " - "
      + item.datas + " - "
      + item.quantidade + " "
      + item.periodo + "(s) ("
      + item.empresaTerceirizada + ")\n";
  });

  textoFinal += "\nUnidade: " + unidade + "\n\n";
  textoFinal += "Terceirizados:\n" + nomes;

  document.getElementById("resultado").value = textoFinal;
}

});
</script>

</body>
</html>
